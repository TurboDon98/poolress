# Анализ миграции Backend -> Frontend

Этот документ описывает план адаптации существующего бекенда (`backend_old`) под текущий фронтенд (`TurboProject 2.0`).

## 1. Что берем (Соответствует функционалу фронтенда)

Следующие модули и эндпоинты необходимы для работы текущих страниц фронтенда:

### Аутентификация (Pages: Login, Register)
*   **Эндпоинты:** `/api/auth/login`, `/api/auth/register`, `/api/auth/me`, `/api/auth/logout`.
*   **Модели:** `User`, `UserSession`.
*   **Изменения:** В таблицу `User` необходимо добавить поля, которые запрашиваются при регистрации на фронте (например, `department`, `position`), так как сейчас там только `full_name`.

### Проекты (Pages: Dashboard, Projects)
*   **Эндпоинты:**
    *   `/api/projects/upload` (Загрузка MPP файлов).
    *   `/api/projects/files` (Список проектов для Дашборда).
    *   `/api/projects/files/{file_id}` (Удаление).
*   **Модели:** `ProjectFile`, `ProjectMeta`.
*   **Логика:** Парсинг MS Project файлов (через Aspose.Tasks или аналог) обязателен.

### Ресурсы (Pages: Resources, Workload)
*   **Эндпоинты:**
    *   `/api/resources/extract` (Извлечение ресурсов из проектов).
    *   `/api/resources/current` (Список ресурсов).
    *   `/api/resources/person_projects` (Связь ресурсов с проектами).
    *   `/api/resource-check/analyze` (Анализ загрузки для страницы `Workload`).
*   **Модели:** `ResourcePerson`, `ResourceState`.

### Качество и Аналитика (Pages: Quality)
*   **Эндпоинты:**
    *   `/api/pk/final/analyze` (Анализ "Паспортов качества").
    *   `/api/projects/overdue_tasks` (Просроченные задачи - полезно для виджетов).
    *   `/api/projects/shift_tasks` (Сдвиги сроков).

## 2. Чего нет во фронтенде (Кандидаты на удаление или скрытие)

Следующие функции реализованы в бекенде, но не имеют интерфейса в текущем Electron-приложении:

*   **Настройка календаря (`/api/settings/calendar`)**:
    *   Во фронтенде страница `Settings` содержит только переключение темы.
    *   *Решение:* Можно оставить код в бекенде "на вырост", но удалить из активного API, либо реализовать минимальный UI позже. Пока можно убрать.
*   **Сложный сравнительный анализ (`/api/analyze-msproject`)**:
    *   Если это специфичная логика старого приложения, не используемая в `Quality` или `Workload`, её стоит убрать.
*   **WebSockets (`/ws/projects`)**:
    *   Фронтенд пока не использует Real-time обновления через сокеты (использует обычные HTTP запросы).
    *   *Решение:* Можно временно отключить/убрать, чтобы упростить деплой.
*   **Отладочные эндпоинты (`/debug_*`)**:
    *   `/api/projects/debug_parse`, `/debug_tasks`, `/debug_introspect`.
    *   *Решение:* Убрать из продакшн-версии.

## 3. План действий

1.  Создать папку `backend` в корне проекта.
2.  Перенести базовую структуру (`main.py`, `db.py`, `models.py`) с очисткой лишних импортов.
3.  Адаптировать `models.py`: Добавить поля в `User`.
4.  Настроить `main.py`: Оставить только перечисленные выше "Нужные" эндпоинты.
5.  Проверить зависимости (`requirements.txt`) и создать новый файл зависимостей.
6.  Подготовить конфигурацию для запуска на сервере (IP: 194.67.127.103).
